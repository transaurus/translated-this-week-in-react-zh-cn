{
  "source_path": "/var/folders/71/_th644vd5kxcpmnfqgtm275m0000gn/T/e2e_transaurus_ut53hddt/tmp9qn097ks/website/articles/useSyncExternalStore-the-underrated-react-api/index.mdx",
  "segments": [
    {
      "id": "58cfcc64",
      "translatable": false,
      "content": "---\nslug: useSyncExternalStore-the-underrated-react-api\ntitle: useSyncExternalStore - The underrated React API\nauthors: [slorber]\ndate: 2022-09-06\ntwitterThreadUrl: \"https://slo.im/t/articles/useSyncExternalStore\"\nimage: ./social-card.png\n---",
      "sourceMdx": "---\nslug: useSyncExternalStore-the-underrated-react-api\ntitle: useSyncExternalStore - The underrated React API\nauthors: [slorber]\ndate: 2022-09-06\ntwitterThreadUrl: \"https://slo.im/t/articles/useSyncExternalStore\"\nimage: ./social-card.png\n---",
      "nodeType": "yaml",
      "translated_content": "@@untranslatable_placeholder_58cfcc64"
    },
    {
      "id": "1cc03ec8",
      "translatable": true,
      "content": "# useSyncExternalStore - The underrated React API",
      "sourceMdx": "# useSyncExternalStore - The underrated React API",
      "nodeType": "heading",
      "translated_content": "# useSyncExternalStore - è¢«ä½ä¼°çš„React API"
    },
    {
      "id": "8d66f911",
      "translatable": true,
      "content": "You might have heard of [`useSyncExternalStore()`](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore), a new React 18 hook to **subscribe to external data sources**. It is often used internally by state management libraries - like [Redux](https://github.com/reduxjs/react-redux/pull/1808) - to implement a **selector system**.",
      "sourceMdx": "You might have heard of [`useSyncExternalStore()`](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore), a new React 18 hook to **subscribe to external data sources**. It is often used internally by state management libraries - like [Redux](https://github.com/reduxjs/react-redux/pull/1808) - to implement a **selector system**.",
      "nodeType": "paragraph",
      "translated_content": "ä½ å¯èƒ½å¬è¯´è¿‡[`useSyncExternalStore()`](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore)ï¼Œè¿™ä¸ªReact 18çš„æ–°Hookç”¨äº**è®¢é˜…å¤–éƒ¨æ•°æ®æº**ã€‚å®ƒå¸¸è¢«çŠ¶æ€ç®¡ç†åº“ï¼ˆå¦‚[Redux](https://github.com/reduxjs/react-redux/pull/1808)ï¼‰å†…éƒ¨ä½¿ç”¨ï¼Œç”¨äºå®ç°**é€‰æ‹©å™¨ç³»ç»Ÿ**ã€‚"
    },
    {
      "id": "ad8fd492",
      "translatable": true,
      "content": "But what about using `useSyncExternalStore()` in your own application code?",
      "sourceMdx": "But what about using `useSyncExternalStore()` in your own application code?",
      "nodeType": "paragraph",
      "translated_content": "ä½†ä½ æ˜¯å¦è€ƒè™‘è¿‡åœ¨è‡ªå·±çš„åº”ç”¨ä»£ç ä¸­ä½¿ç”¨`useSyncExternalStore()`ï¼Ÿ"
    },
    {
      "id": "86b54d44",
      "translatable": true,
      "content": "In this interactive article, I want to present you a problem: **over-returning React hooks triggering useless re-renders**. We will see how `useSyncExternalStore()` can be a good fix.",
      "sourceMdx": "In this interactive article, I want to present you a problem: **over-returning React hooks triggering useless re-renders**. We will see how `useSyncExternalStore()` can be a good fix.",
      "nodeType": "paragraph",
      "translated_content": "åœ¨è¿™ç¯‡äº’åŠ¨æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³æå‡ºä¸€ä¸ªé—®é¢˜ï¼š**è¿‡åº¦è¿”å›å€¼çš„React Hookä¼šè§¦å‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“**ã€‚æˆ‘ä»¬å°†çœ‹åˆ°`useSyncExternalStore()`å¦‚ä½•æˆä¸ºè§£å†³æ–¹æ¡ˆã€‚"
    },
    {
      "id": "39b3772c",
      "translatable": true,
      "content": "![social card](./social-card.png)",
      "sourceMdx": "![social card](./social-card.png)",
      "nodeType": "paragraph",
      "translated_content": "![ç¤¾äº¤å¡ç‰‡](./social-card.png)"
    },
    {
      "id": "c6da205d",
      "translatable": false,
      "content": "<!-- truncate -->",
      "sourceMdx": "<!-- truncate -->",
      "nodeType": "comment",
      "translated_content": "@@untranslatable_placeholder_c6da205d"
    },
    {
      "id": "5dfba1c3",
      "translatable": false,
      "content": "<SubscribeFormEmbed />",
      "sourceMdx": "<SubscribeFormEmbed />",
      "nodeType": "mdxJsxFlowElement",
      "translated_content": "@@untranslatable_placeholder_5dfba1c3"
    },
    {
      "id": "0adfe0aa",
      "translatable": false,
      "content": "[//]: <> (ESM Import/Export)",
      "sourceMdx": "import {\n  App,\n  AppFixed,\n  ScrollApp,\n} from \"@site/articles/useSyncExternalStore-the-underrated-react-api/demos\";",
      "nodeType": "mdxjsEsm",
      "translated_content": "@@untranslatable_placeholder_0adfe0aa"
    },
    {
      "id": "d06306f7",
      "translatable": true,
      "content": "## Over-returning hooks",
      "sourceMdx": "## Over-returning hooks",
      "nodeType": "heading",
      "translated_content": "## è¿‡åº¦è¿”å›çš„Hook"
    },
    {
      "id": "73ab96a3",
      "translatable": true,
      "content": "Let's illustrate the problem with [`useLocation()`](https://reactrouter.com/en/main/hooks/use-location) from React-Router.",
      "sourceMdx": "Let's illustrate the problem with [`useLocation()`](https://reactrouter.com/en/main/hooks/use-location) from React-Router.",
      "nodeType": "paragraph",
      "translated_content": "è®©æˆ‘ä»¬ç”¨React-Routerçš„[`useLocation()`](https://reactrouter.com/en/main/hooks/use-location)æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ã€‚"
    },
    {
      "id": "7499a4e7",
      "translatable": true,
      "content": "This hook returns an object with many attributes (`pathname`, `hash`, `search`...), but you might not read all of them. Just calling the hook will trigger re-renders when any of these attributes is updated.",
      "sourceMdx": "This hook returns an object with many attributes (`pathname`, `hash`, `search`...), but you might not read all of them. Just calling the hook will trigger re-renders when any of these attributes is updated.",
      "nodeType": "paragraph",
      "translated_content": "è¯¥Hookè¿”å›åŒ…å«å¤šä¸ªå±æ€§ï¼ˆ`pathname`ã€`hash`ã€`search`ç­‰ï¼‰çš„å¯¹è±¡ï¼Œä½†ä½ å¯èƒ½ä¸ä¼šä½¿ç”¨å…¨éƒ¨å±æ€§ã€‚ä»…è°ƒç”¨è¯¥Hookå°±ä¼šåœ¨ä»»æ„å±æ€§æ›´æ–°æ—¶è§¦å‘é‡æ–°æ¸²æŸ“ã€‚"
    },
    {
      "id": "517051a7",
      "translatable": true,
      "content": "Let's consider this app:",
      "sourceMdx": "Let's consider this app:",
      "nodeType": "paragraph",
      "translated_content": "è€ƒè™‘ä»¥ä¸‹åº”ç”¨ï¼š"
    },
    {
      "id": "4dd51304",
      "translatable": false,
      "content": "```tsx\nfunction CurrentPathname() {\n  const { pathname } = useLocation();\n  return <div>{pathname}</div>;\n}\n\nfunction CurrentHash() {\n  const { hash } = useLocation();\n  return <div>{hash}</div>;\n}\n\nfunction Links() {\n  return (\n    <div>\n      <Link to=\"#link1\">#link1</Link>\n      <Link to=\"#link2\">#link2</Link>\n      <Link to=\"#link3\">#link3</Link>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <div>\n      <CurrentPathname />\n      <CurrentHash />\n      <Links />\n    </div>\n  );\n}\n```",
      "sourceMdx": "```tsx\nfunction CurrentPathname() {\n  const { pathname } = useLocation();\n  return <div>{pathname}</div>;\n}\n\nfunction CurrentHash() {\n  const { hash } = useLocation();\n  return <div>{hash}</div>;\n}\n\nfunction Links() {\n  return (\n    <div>\n      <Link to=\"#link1\">#link1</Link>\n      <Link to=\"#link2\">#link2</Link>\n      <Link to=\"#link3\">#link3</Link>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <div>\n      <CurrentPathname />\n      <CurrentHash />\n      <Links />\n    </div>\n  );\n}\n```",
      "nodeType": "code",
      "translated_content": "@@untranslatable_placeholder_4dd51304"
    },
    {
      "id": "61a24b68",
      "translatable": false,
      "content": "<App />",
      "sourceMdx": "<App />",
      "nodeType": "mdxJsxFlowElement",
      "translated_content": "@@untranslatable_placeholder_61a24b68"
    },
    {
      "id": "147e8550",
      "translatable": true,
      "content": "On any hash link click, the `CurrentPathname` component will re-render, even if it's not even using the `hash` attribute ğŸ˜….",
      "sourceMdx": "On any hash link click, the `CurrentPathname` component will re-render, even if it's not even using the `hash` attribute ğŸ˜….",
      "nodeType": "paragraph",
      "translated_content": "æ¯æ¬¡ç‚¹å‡»å“ˆå¸Œé“¾æ¥æ—¶ï¼Œ`CurrentPathname`ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“â€”â€”å³ä½¿å®ƒæ ¹æœ¬æ²¡æœ‰ä½¿ç”¨`hash`å±æ€§ ğŸ˜…ã€‚"
    },
    {
      "id": "07837485",
      "translatable": true,
      "content": ":::tip\n\nWhenever a hook returns data that you don't display, think about React re-renders. If you don't pay attention, a tiny `useLocation()` call added at the top of a React tree could harm your app's performance.\n\n:::",
      "sourceMdx": ":::tip\n\nWhenever a hook returns data that you don't display, think about React re-renders. If you don't pay attention, a tiny `useLocation()` call added at the top of a React tree could harm your app's performance.\n\n:::",
      "nodeType": "containerDirective",
      "translated_content": ":::tip\n\nå½“Hookè¿”å›çš„æ•°æ®æœªè¢«ä½¿ç”¨æ—¶ï¼Œè¯·è€ƒè™‘Reactçš„é‡æ–°æ¸²æŸ“æœºåˆ¶ã€‚å¦‚æœä¸åŠ æ³¨æ„ï¼Œåœ¨Reactæ ‘é¡¶éƒ¨æ·»åŠ çš„ä¸€ä¸ªå°å°`useLocation()`è°ƒç”¨å°±å¯èƒ½æŸå®³åº”ç”¨æ€§èƒ½ã€‚\n\n:::"
    },
    {
      "id": "f5db8e60",
      "translatable": true,
      "content": ":::info\n\nThe goal is not to criticize React-Router, but rather to illustrate the problem. `useLocation()` is just a good pragmatic candidate to create this interactive article. Your own React hooks and other third-party libraries might also over-return.\n\n:::",
      "sourceMdx": ":::info\n\nThe goal is not to criticize React-Router, but rather to illustrate the problem. `useLocation()` is just a good pragmatic candidate to create this interactive article. Your own React hooks and other third-party libraries might also over-return.\n\n:::",
      "nodeType": "containerDirective",
      "translated_content": ":::info\n\næœ¬æ–‡å¹¶éæ‰¹è¯„React-Routerï¼Œè€Œæ˜¯ä¸ºäº†è¯´æ˜é—®é¢˜ã€‚`useLocation()`åªæ˜¯æ„å»ºè¿™ç¯‡äº’åŠ¨æ–‡ç« çš„å…¸å‹æ¡ˆä¾‹ã€‚ä½ è‡ªå·±çš„React Hookæˆ–å…¶ä»–ç¬¬ä¸‰æ–¹åº“ä¹Ÿå¯èƒ½å­˜åœ¨è¿‡åº¦è¿”å›å€¼çš„æƒ…å†µã€‚\n\n:::"
    },
    {
      "id": "1c598ecd",
      "translatable": true,
      "content": "## `useSyncExternalStore` to the rescue?",
      "sourceMdx": "## `useSyncExternalStore` to the rescue?",
      "nodeType": "heading",
      "translated_content": "## `useSyncExternalStore`æ¥æ•‘æ´ï¼Ÿ"
    },
    {
      "id": "2547a6bb",
      "translatable": true,
      "content": "The [official documentation](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore) says:",
      "sourceMdx": "The [official documentation](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore) says:",
      "nodeType": "paragraph",
      "translated_content": "[å®˜æ–¹æ–‡æ¡£](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore)è¯´æ˜ï¼š"
    },
    {
      "id": "30d027a1",
      "translatable": true,
      "content": "> useSyncExternalStore is a hook recommended for reading and subscribing from external data sources in a way thatâ€™s compatible with concurrent rendering features like selective hydration and time slicing.\n> This method returns the value of the store and accepts three arguments:\n>\n> * `subscribe`: function to register a callback that is called whenever the store changes.\n> * `getSnapshot`: function that returns the current value of the store.\n> * `getServerSnapshot`: function that returns the snapshot used during server rendering.",
      "sourceMdx": "> useSyncExternalStore is a hook recommended for reading and subscribing from external data sources in a way thatâ€™s compatible with concurrent rendering features like selective hydration and time slicing.\n> This method returns the value of the store and accepts three arguments:\n>\n> - `subscribe`: function to register a callback that is called whenever the store changes.\n> - `getSnapshot`: function that returns the current value of the store.\n> - `getServerSnapshot`: function that returns the snapshot used during server rendering.",
      "nodeType": "blockquote",
      "translated_content": "> useSyncExternalStoreæ˜¯ä¸€ä¸ªæ¨èç”¨äºè¯»å–å’Œè®¢é˜…å¤–éƒ¨æ•°æ®æºçš„Hookï¼Œå…¶å®ç°æ–¹å¼ä¸é€‰æ‹©æ€§æ³¨æ°´å’Œæ—¶é—´åˆ‡ç‰‡ç­‰å¹¶å‘æ¸²æŸ“ç‰¹æ€§å…¼å®¹ã€‚\n> è¯¥æ–¹æ³•è¿”å›å­˜å‚¨çš„å€¼å¹¶æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š\n>\n> - `subscribe`: ç”¨äºæ³¨å†Œåœ¨å­˜å‚¨å˜åŒ–æ—¶è¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°\n> - `getSnapshot`: è¿”å›å­˜å‚¨å½“å‰å€¼çš„å‡½æ•°\n> - `getServerSnapshot`: æœåŠ¡ç«¯æ¸²æŸ“æ—¶è¿”å›å¿«ç…§çš„å‡½æ•°"
    },
    {
      "id": "ec99e704",
      "translatable": false,
      "content": "```tsx\nfunction useSyncExternalStore<Snapshot>(\n  subscribe: (onStoreChange: () => void) => () => void,\n  getSnapshot: () => Snapshot,\n  getServerSnapshot?: () => Snapshot,\n): Snapshot;\n```",
      "sourceMdx": "```tsx\nfunction useSyncExternalStore<Snapshot>(\n  subscribe: (onStoreChange: () => void) => () => void,\n  getSnapshot: () => Snapshot,\n  getServerSnapshot?: () => Snapshot,\n): Snapshot;\n```",
      "nodeType": "code",
      "translated_content": "@@untranslatable_placeholder_ec99e704"
    },
    {
      "id": "2838eb68",
      "translatable": true,
      "content": "This feels a bit abstract. This [beta doc page](https://beta.reactjs.org/learn/you-might-not-need-an-effect#subscribing-to-an-external-store) gives a good example:",
      "sourceMdx": "This feels a bit abstract. This [beta doc page](https://beta.reactjs.org/learn/you-might-not-need-an-effect#subscribing-to-an-external-store) gives a good example:",
      "nodeType": "paragraph",
      "translated_content": "è¿™å¬èµ·æ¥æœ‰äº›æŠ½è±¡ã€‚[Betaç‰ˆæ–‡æ¡£](https://beta.reactjs.org/learn/you-might-not-need-an-effect#subscribing-to-an-external-store)æä¾›äº†å¾ˆå¥½çš„ç¤ºä¾‹ï¼š"
    },
    {
      "id": "de26f08a",
      "translatable": false,
      "content": "```tsx\nfunction subscribe(callback) {\n  window.addEventListener(\"online\", callback);\n  window.addEventListener(\"offline\", callback);\n  return () => {\n    window.removeEventListener(\"online\", callback);\n    window.removeEventListener(\"offline\", callback);\n  };\n}\n\nfunction useOnlineStatus() {\n  return useSyncExternalStore(\n    subscribe,\n    () => navigator.onLine,\n    () => true,\n  );\n}\n\nfunction ChatIndicator() {\n  const isOnline = useOnlineStatus();\n  // ...\n}\n```",
      "sourceMdx": "```tsx\nfunction subscribe(callback) {\n  window.addEventListener(\"online\", callback);\n  window.addEventListener(\"offline\", callback);\n  return () => {\n    window.removeEventListener(\"online\", callback);\n    window.removeEventListener(\"offline\", callback);\n  };\n}\n\nfunction useOnlineStatus() {\n  return useSyncExternalStore(\n    subscribe,\n    () => navigator.onLine,\n    () => true,\n  );\n}\n\nfunction ChatIndicator() {\n  const isOnline = useOnlineStatus();\n  // ...\n}\n```",
      "nodeType": "code",
      "translated_content": "@@untranslatable_placeholder_de26f08a"
    },
    {
      "id": "53aa2b95",
      "translatable": true,
      "content": "It turns out that the browser history can also be considered as an external data source. Let's see how to use `useSyncExternalStore` with React-Router!",
      "sourceMdx": "It turns out that the browser history can also be considered as an external data source. Let's see how to use `useSyncExternalStore` with React-Router!",
      "nodeType": "paragraph",
      "translated_content": "å®é™…ä¸Šï¼Œæµè§ˆå™¨å†å²è®°å½•ä¹Ÿå¯ä»¥è¢«è§†ä¸ºå¤–éƒ¨æ•°æ®æºã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å°†`useSyncExternalStore`ä¸React-Routerç»“åˆä½¿ç”¨ï¼"
    },
    {
      "id": "c766290e",
      "translatable": true,
      "content": "## Implementing `useHistorySelector()`",
      "sourceMdx": "## Implementing `useHistorySelector()`",
      "nodeType": "heading",
      "translated_content": "## å®ç°`useHistorySelector()`"
    },
    {
      "id": "5c7d994c",
      "translatable": true,
      "content": "React-Router expose everything we need to wire `useSyncExternalStore`:",
      "sourceMdx": "React-Router expose everything we need to wire `useSyncExternalStore`:",
      "nodeType": "paragraph",
      "translated_content": "React-Routeræä¾›äº†æˆ‘ä»¬è¿æ¥`useSyncExternalStore`æ‰€éœ€çš„ä¸€åˆ‡ï¼š"
    },
    {
      "id": "ecba4df2",
      "translatable": true,
      "content": "* access the browser history with [`useHistory()`](https://v5.reactrouter.com/web/api/Hooks/usehistory)\n* subscribe for history updates with [`history.listen(callback)`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#history.listen)\n* access a snapshot of the current location with [`history.location`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#historylocation)",
      "sourceMdx": "- access the browser history with [`useHistory()`](https://v5.reactrouter.com/web/api/Hooks/usehistory)\n- subscribe for history updates with [`history.listen(callback)`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#history.listen)\n- access a snapshot of the current location with [`history.location`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#historylocation)",
      "nodeType": "list",
      "translated_content": "- é€šè¿‡[`useHistory()`](https://v5.reactrouter.com/web/api/Hooks/usehistory)è®¿é—®æµè§ˆå™¨å†å²è®°å½•\n- é€šè¿‡[`history.listen(callback)`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#history.listen)è®¢é˜…å†å²è®°å½•æ›´æ–°\n- é€šè¿‡[`history.location`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#historylocation)è®¿é—®å½“å‰ä½ç½®å¿«ç…§"
    },
    {
      "id": "51186659",
      "translatable": true,
      "content": ":::caution\n\nThis website uses React-Router v5: the solution will be different for React-Router v6 ([see](https://twitter.com/Zh0uzi/status/1567523679604539405)).\n\n:::",
      "sourceMdx": ":::caution\n\nThis website uses React-Router v5: the solution will be different for React-Router v6 ([see](https://twitter.com/Zh0uzi/status/1567523679604539405)).\n\n:::",
      "nodeType": "containerDirective",
      "translated_content": ":::caution\n\næœ¬ç½‘ç«™ä½¿ç”¨React-Router v5ï¼šReact-Router v6çš„è§£å†³æ–¹æ¡ˆä¼šæœ‰æ‰€ä¸åŒï¼ˆ[å‚è§](https://twitter.com/Zh0uzi/status/1567523679604539405)ï¼‰ã€‚\n\n:::"
    },
    {
      "id": "681ef526",
      "translatable": true,
      "content": "The implementation of `useHistorySelector()` relatively simple:",
      "sourceMdx": "The implementation of `useHistorySelector()` relatively simple:",
      "nodeType": "paragraph",
      "translated_content": "`useHistorySelector()` çš„å®ç°ç›¸å¯¹ç®€å•ï¼š"
    },
    {
      "id": "eb25bb8c",
      "translatable": false,
      "content": "```tsx\nfunction useHistorySelector(selector) {\n  const history = useHistory();\n  return useSyncExternalStore(history.listen, () =>\n    selector(history),\n  );\n}\n```",
      "sourceMdx": "```tsx\nfunction useHistorySelector(selector) {\n  const history = useHistory();\n  return useSyncExternalStore(history.listen, () =>\n    selector(history),\n  );\n}\n```",
      "nodeType": "code",
      "translated_content": "@@untranslatable_placeholder_eb25bb8c"
    },
    {
      "id": "44285072",
      "translatable": true,
      "content": "Let's use it in our app:",
      "sourceMdx": "Let's use it in our app:",
      "nodeType": "paragraph",
      "translated_content": "è®©æˆ‘ä»¬åœ¨åº”ç”¨ä¸­ä½¿ç”¨å®ƒï¼š"
    },
    {
      "id": "5680b15c",
      "translatable": false,
      "content": "```tsx\nfunction CurrentPathname() {\n  const pathname = useHistorySelector(\n    (history) => history.location.pathname,\n  );\n  return <div>{pathname}</div>;\n}\n\nfunction CurrentHash() {\n  const hash = useHistorySelector(\n    (history) => history.location.hash,\n  );\n  return <div>{hash}</div>;\n}\n```",
      "sourceMdx": "```tsx\nfunction CurrentPathname() {\n  const pathname = useHistorySelector(\n    (history) => history.location.pathname,\n  );\n  return <div>{pathname}</div>;\n}\n\nfunction CurrentHash() {\n  const hash = useHistorySelector(\n    (history) => history.location.hash,\n  );\n  return <div>{hash}</div>;\n}\n```",
      "nodeType": "code",
      "translated_content": "@@untranslatable_placeholder_5680b15c"
    },
    {
      "id": "b905852a",
      "translatable": false,
      "content": "<AppFixed />",
      "sourceMdx": "<AppFixed />",
      "nodeType": "mdxJsxFlowElement",
      "translated_content": "@@untranslatable_placeholder_b905852a"
    },
    {
      "id": "dc72fd20",
      "translatable": true,
      "content": "Now, when you click on a hash link above, the `CurrentPathname` component will **not re-render** anymore!",
      "sourceMdx": "Now, when you click on a hash link above, the `CurrentPathname` component will **not re-render** anymore!",
      "nodeType": "paragraph",
      "translated_content": "ç°åœ¨ï¼Œå½“ä½ ç‚¹å‡»ä¸Šé¢çš„å“ˆå¸Œé“¾æ¥æ—¶ï¼Œ`CurrentPathname` ç»„ä»¶å°†**ä¸å†é‡æ–°æ¸²æŸ“**ï¼"
    },
    {
      "id": "445c72bd",
      "translatable": true,
      "content": "## Another example: `scrollY`",
      "sourceMdx": "## Another example: `scrollY`",
      "nodeType": "heading",
      "translated_content": "## å¦ä¸€ä¸ªç¤ºä¾‹ï¼š`scrollY`"
    },
    {
      "id": "9ef42155",
      "translatable": true,
      "content": "There are so many external data sources that we can subscribe to, and implementing your own selector system on top might enable you to optimize React re-renders.",
      "sourceMdx": "There are so many external data sources that we can subscribe to, and implementing your own selector system on top might enable you to optimize React re-renders.",
      "nodeType": "paragraph",
      "translated_content": "æˆ‘ä»¬å¯ä»¥è®¢é˜…çš„å¤–éƒ¨æ•°æ®æºéå¸¸å¤šï¼Œåœ¨å…¶åŸºç¡€ä¸Šå®ç°è‡ªå·±çš„é€‰æ‹©å™¨ç³»ç»Ÿå¯èƒ½æœ‰åŠ©äºä¼˜åŒ– React çš„é‡æ–°æ¸²æŸ“ã€‚"
    },
    {
      "id": "fe25bd72",
      "translatable": true,
      "content": "For example, let's consider we want to use the `scrollY` position of a page. We can implement this custom React hook:",
      "sourceMdx": "For example, let's consider we want to use the `scrollY` position of a page. We can implement this custom React hook:",
      "nodeType": "paragraph",
      "translated_content": "ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³ä½¿ç”¨é¡µé¢çš„ `scrollY` ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥å®ç°è¿™ä¸ªè‡ªå®šä¹‰ React Hookï¼š"
    },
    {
      "id": "65ba7468",
      "translatable": false,
      "content": "```tsx\n// A memoized constant fn prevents unsubscribe/resubscribe\n// In practice it is not a big deal\nfunction subscribe(onStoreChange) {\n  global.window?.addEventListener(\"scroll\", onStoreChange);\n  return () =>\n    global.window?.removeEventListener(\n      \"scroll\",\n      onStoreChange,\n    );\n}\n\nfunction useScrollY(selector = (id) => id) {\n  return useSyncExternalStore(\n    subscribe,\n    () => selector(global.window?.scrollY),\n    () => undefined,\n  );\n}\n```",
      "sourceMdx": "```tsx\n// A memoized constant fn prevents unsubscribe/resubscribe\n// In practice it is not a big deal\nfunction subscribe(onStoreChange) {\n  global.window?.addEventListener(\"scroll\", onStoreChange);\n  return () =>\n    global.window?.removeEventListener(\n      \"scroll\",\n      onStoreChange,\n    );\n}\n\nfunction useScrollY(selector = (id) => id) {\n  return useSyncExternalStore(\n    subscribe,\n    () => selector(global.window?.scrollY),\n    () => undefined,\n  );\n}\n```",
      "nodeType": "code",
      "translated_content": "@@untranslatable_placeholder_65ba7468"
    },
    {
      "id": "e6ac016e",
      "translatable": true,
      "content": "We can now use this hook with an optional selector:",
      "sourceMdx": "We can now use this hook with an optional selector:",
      "nodeType": "paragraph",
      "translated_content": "ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª Hook å¹¶ä¼ å…¥ä¸€ä¸ªå¯é€‰çš„é€‰æ‹©å™¨ï¼š"
    },
    {
      "id": "5b2e44c7",
      "translatable": false,
      "content": "```tsx\nfunction ScrollY() {\n  const scrollY = useScrollY();\n  return <div>{scrollY}</div>;\n}\n\nfunction ScrollYFloored() {\n  const to = 100;\n  const scrollYFloored = useScrollY((y) =>\n    y ? Math.floor(y / to) * to : undefined,\n  );\n  return <div>{scrollYFloored}</div>;\n}\n```",
      "sourceMdx": "```tsx\nfunction ScrollY() {\n  const scrollY = useScrollY();\n  return <div>{scrollY}</div>;\n}\n\nfunction ScrollYFloored() {\n  const to = 100;\n  const scrollYFloored = useScrollY((y) =>\n    y ? Math.floor(y / to) * to : undefined,\n  );\n  return <div>{scrollYFloored}</div>;\n}\n```",
      "nodeType": "code",
      "translated_content": "@@untranslatable_placeholder_5b2e44c7"
    },
    {
      "id": "70c65cb9",
      "translatable": false,
      "content": "<ScrollApp />",
      "sourceMdx": "<ScrollApp />",
      "nodeType": "mdxJsxFlowElement",
      "translated_content": "@@untranslatable_placeholder_70c65cb9"
    },
    {
      "id": "61e5dad6",
      "translatable": true,
      "content": "Scroll the page and see how the components above re-render? One is re-rendering less than the other!",
      "sourceMdx": "Scroll the page and see how the components above re-render? One is re-rendering less than the other!",
      "nodeType": "paragraph",
      "translated_content": "æ»šåŠ¨é¡µé¢å¹¶è§‚å¯Ÿä¸Šæ–¹ç»„ä»¶çš„é‡æ–°æ¸²æŸ“æƒ…å†µï¼Ÿå…¶ä¸­ä¸€ä¸ªç»„ä»¶çš„é‡æ–°æ¸²æŸ“æ¬¡æ•°æ¯”å¦ä¸€ä¸ªå°‘ï¼"
    },
    {
      "id": "78bd731b",
      "translatable": true,
      "content": ":::info\n\nWhen you don't need a `scrollY` 1 pixel precision level, returning a wide range value such as `scrollY` can also be considered as over-returning. Consider returning a narrower value.\n\nFor example: a `useResponsiveBreakpoint()` hook that only returns a limited set of values (`small`, `medium` or `large`) will be more optimized than a `useViewportWidth()` hook.\n\nIf a React component only handles `large` screens differently, you can create an even narrower `useIsLargeScreen()` hook returning a boolean.\n\n:::",
      "sourceMdx": ":::info\n\nWhen you don't need a `scrollY` 1 pixel precision level, returning a wide range value such as `scrollY` can also be considered as over-returning. Consider returning a narrower value.\n\nFor example: a `useResponsiveBreakpoint()` hook that only returns a limited set of values (`small`, `medium` or `large`) will be more optimized than a `useViewportWidth()` hook.\n\nIf a React component only handles `large` screens differently, you can create an even narrower `useIsLargeScreen()` hook returning a boolean.\n\n:::",
      "nodeType": "containerDirective",
      "translated_content": ":::info\n\nå½“ä½ ä¸éœ€è¦ `scrollY` çš„ 1 åƒç´ ç²¾åº¦æ—¶ï¼Œè¿”å›ä¸€ä¸ªå®½æ³›çš„å€¼ï¼ˆå¦‚ `scrollY`ï¼‰ä¹Ÿå¯ä»¥è¢«è§†ä¸ºè¿‡åº¦è¿”å›ã€‚è€ƒè™‘è¿”å›ä¸€ä¸ªæ›´çª„çš„å€¼ã€‚\n\nä¾‹å¦‚ï¼šä¸€ä¸ªä»…è¿”å›æœ‰é™å€¼é›†ï¼ˆ`small`ã€`medium` æˆ– `large`ï¼‰çš„ `useResponsiveBreakpoint()` Hook ä¼šæ¯”è¿”å› `useViewportWidth()` çš„ Hook æ›´ä¼˜åŒ–ã€‚\n\nå¦‚æœä¸€ä¸ª React ç»„ä»¶ä»…é’ˆå¯¹ `large` å±å¹•æœ‰ä¸åŒå¤„ç†ï¼Œä½ ç”šè‡³å¯ä»¥åˆ›å»ºä¸€ä¸ªæ›´çª„çš„ `useIsLargeScreen()` Hookï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚\n\n:::"
    },
    {
      "id": "67dfd717",
      "translatable": true,
      "content": "## Conclusion",
      "sourceMdx": "## Conclusion",
      "nodeType": "heading",
      "translated_content": "## ç»“è®º"
    },
    {
      "id": "ba12acea",
      "translatable": true,
      "content": "I hope this article convinced you to take a second look at `useSyncExternalStore()`. I feel this hook is currently underused in the React ecosystem, and deserves a bit more attention. There are many external data sources that you can subscribe to.",
      "sourceMdx": "I hope this article convinced you to take a second look at `useSyncExternalStore()`. I feel this hook is currently underused in the React ecosystem, and deserves a bit more attention. There are many external data sources that you can subscribe to.",
      "nodeType": "paragraph",
      "translated_content": "æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½è®©ä½ é‡æ–°å®¡è§† `useSyncExternalStore()`ã€‚æˆ‘è§‰å¾—è¿™ä¸ª Hook ç›®å‰åœ¨ React ç”Ÿæ€ç³»ç»Ÿä¸­ä½¿ç”¨ä¸è¶³ï¼Œå€¼å¾—æ›´å¤šå…³æ³¨ã€‚æœ‰è®¸å¤šå¤–éƒ¨æ•°æ®æºå¯ä»¥è®¢é˜…ã€‚"
    },
    {
      "id": "4033c370",
      "translatable": true,
      "content": "If you still haven't upgraded to React 18, there's a npm [use-sync-external-store](https://www.npmjs.com/package/use-sync-external-store) shim that you can already use today in older versions. There is also a `use-sync-external-store/with-selector` export in case you need to return a memoized non-primitive value.",
      "sourceMdx": "If you still haven't upgraded to React 18, there's a npm [use-sync-external-store](https://www.npmjs.com/package/use-sync-external-store) shim that you can already use today in older versions. There is also a `use-sync-external-store/with-selector` export in case you need to return a memoized non-primitive value.",
      "nodeType": "paragraph",
      "translated_content": "å¦‚æœä½ è¿˜æ²¡æœ‰å‡çº§åˆ° React 18ï¼Œå¯ä»¥ä½¿ç”¨ npm ä¸Šçš„ [use-sync-external-store](https://www.npmjs.com/package/use-sync-external-store) å«ç‰‡ï¼Œå®ƒå·²ç»æ”¯æŒæ—§ç‰ˆæœ¬ã€‚å¦‚æœä½ éœ€è¦è¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„éåŸå§‹å€¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `use-sync-external-store/with-selector` å¯¼å‡ºã€‚"
    }
  ]
}