---
slug: /176
title: "This Week In React #176: useActionState, React Compiler, Million Lint, TanStack, Generative UI, Vinxi, Remix i18n, Next.js security, Typesafe Router, Shopify RN perf, RCTRootViewFactory, iOS Live Activities, Uni Stack, TypeScript, Parcel..."
authors: [slorber, bndkt]
date: 03-06-2024
---

大家好！

本周资讯难以一言蔽之，有太多值得关注的动态，我甚至不知该重点推荐哪些。

最引人注目的是React核心即将推出新钩子取代令人困惑的`useFormState`，现在连React Native开发者也能使用它了！

<!-- truncate -->

**💡 [在Twitter上浏览本期简报](https://slo.im/thread) - 可视化版式 🎨**

---

import Support from "../_support.mdx";

<Support />

---

## 💸 赞助商 {#sponsor1}

[![Axiom - Vercel应用的最佳日志平台](/emails/issues/171/axiom.jpg)](https://axiom.co/vercel)

**[Axiom - Vercel应用的最佳日志平台](https://axiom.co/vercel)**

😴 安心入眠吧，Axiom为Vercel项目提供的零配置可观测性已为您保驾护航。

- 使用Axiom预建仪表板总览所有Vercel日志与性能指标，一键钻取特定项目与部署详情，洞悉函数执行表现
- [next-axiom](https://github.com/axiomhq/next-axiom)支持从Next.js项目的任何环节（客户端、边缘或服务端）直接发送日志事件，无需特殊配置
- 轻松从代码发送结构化日志，并与Vercel日志协同分析

Axiom高效捕获100%事件数据，您再也不用担心采样偏差或数据保留问题，用户真实体验尽在掌握。

**附**：[我本人用它监控简报订阅数据](https://twitter.com/sebastienlorber/status/1528666563452317696) 😉

---

## ⚛️ React动态 {#react}

[![React核心PR - 新useActionState钩子](/emails/issues/176/useActionState.jpg)](https://github.com/facebook/react/pull/28491)

**[React核心PR - 新useActionState钩子](https://github.com/facebook/react/pull/28491)**

原`useFormState`钩子存在命名误导，其设计初衷本不仅限于表单场景。React团队正通过新钩子解决这个问题：

- 将`useFormState`重命名为`useActionState`
- 在返回元组中新增pending状态
- 将该钩子迁移至`react`主包

从`react-dom`移至`react`意味着React Native等渲染器现在也能使用它。PR中还详述了"渐进增强"等新特性及注意事项。

---

- 💸 [使用PDF密文保护文档安全。了解如何通过React实现PDF敏感信息脱敏处理，详情请访问我们的博客](https://apryse.com/blog/pdf-redaction-using-react?utm_source=this%20week%20in%20react&utm_medium=newsletter3)
- 🐦 [React 19 ≠ React编译器](https://twitter.com/sebastienlorber/status/1764950877620654474)：React Labs的公告存在歧义导致误解，特此澄清。编译器很可能在React 19.0正式版之后作为独立项目发布，初期可能以Babel/TypeScript插件形式提供。其内部架构解耦设计使得未来适配Rust并非难事。
- 🐦 [TanStack Start框架预览](https://twitter.com/tannerlinsley/status/1765120904370307438)：Tanner正在基于Vinxi和TanStack Router开发全栈框架TanStack Start，本次预览展示了他将TanStack官网迁移至该框架的过程。
- 📜 [Vercel发布AI SDK 3.0支持生成式UI](https://vercel.com/blog/ai-sdk-3-generative-ui)：借助React服务端组件特性，AI SDK 3.0现在可以直接从大语言模型流式传输UI组件，演示效果令人惊艳！
- 📜 [Next.js应用路由实现静态渲染付费内容的安全方案](https://www.ericburel.tech/blog/static-paid-content-app-router)：论证了使用Next.js布局进行身份验证存在安全隐患，受保护内容仍可能通过RSC端点泄露，建议改用中间件方案。
- 📜 [Remix国际化方案详解](https://remix.run/blog/remix-i18n)：从i18n基础原理出发，详解Remix框架下的多种国际化实现方案，利用可选路由段可实现本地化子目录结构。
- 📜 [手写类型安全的React路由只需500行代码？](https://sinja.io/blog/build-typesafe-react-router-from-scratch)：这篇深度好文既能帮助你理解现有路由原理，也是学习高级TypeScript类型编程的绝佳教材。
- 📜 [无需JavaScript的乱序HTML流式渲染](https://lamplightdev.com/blog/2024/01/10/streaming-html-out-of-order-without-javascript/)：这个创新演示证明只需声明式Shadow DOM和插槽技术就能实现HTML分块乱序传输与正确渲染。未来RSC流式传输+Suspense或许能借鉴此技术替代内联JavaScript方案。
- 📜 [Vinxi实现简易RSC](https://www.brenelz.com/posts/simple-rsc-with-vinxi/)：Vinxi SDK可帮助你构建自定义全栈框架，其插件系统甚至支持React服务端组件。
- 📜 [Million.js推出noSlot模式](https://million.dev/blog/block-noSlot)：Million编译器可能自动用`<slot>`包裹组件导致样式问题，新实验性noSlot模式可解决此问题。
- 📜 [Next.js集成Monaco编辑器实现自定义工作流](https://deno.com/blog/monaco-nextjs)：本教程还演示了如何将非受信任用户代码部署到Deno环境。
- 📜 [React与RSC的思维模型](https://ondrejvelisek.github.io/conceptual-model-of-react-and-rsc/)：对UI=f(state)公式进行创新思考，论证RSC某种程度上打破了React原始模型。
- 📜 [为什么React服务端组件要破而后立](https://www.builder.io/blog/why-react-server-components)
- 📜 [告别Gatsby之旅](https://www.smashingmagazine.com/2024/03/end-of-gatsby-journey/)
- 📜 [React Admin 2024年3月更新](https://marmelab.com/blog/2024/03/05/react-admin-march-2024-update.html)
- 📦 [Million Lint公开测试版](https://million.dev/blog/lint)：这款VSCode扩展通过动态分析帮助保持React代码性能，比React Devtools火焰图更易用。后续将推出基于AI的Lint++付费服务，自动推荐性能优化方案。
- 📦 [react-unforget - React应用自动优化编译器](https://github.com/mohebifar/react-unforget)：继Forgetti之后社区又一款React编译器方案。另参阅🐦 [Joe Savona的反馈](https://twitter.com/en_JS/status/1763593971224494106)。
- 📦 [Remix 2.8 - 向buildEnd钩子传递解析后的viteConfig](https://remix.run/docs/en/main/start/changelog#v280)
- 📦 [React Query 5.25 - 新增skipToken实现类型安全的查询禁用](https://github.com/TanStack/query/releases/tag/v5.25.0)
- 📦 [TanStack Router 1.18 - 支持路由分组](https://github.com/TanStack/router/releases/tag/v1.18.0)
- 📦 [Starlight 0.21 - 新增Steps和FileTree等UI组件](https://starlight.astro.build/guides/components/)
- 📦 [Storybook 8.0候选版 - 已达到生产环境稳定性要求](https://github.com/storybookjs/storybook/releases/tag/v8.0.0-rc.0)
- 📦 [Onborda - 基于Framer Motion的Next.js引导式交互组件](https://github.com/uixmat/onborda)
- 📦 [Input-OTP - React一次性密码输入组件](https://input-otp.rodz.dev/)
- 📦 [Panda 0.33发布](https://github.com/chakra-ui/panda/discussions/2274)
- 📦 [UVCanvas - 精美着色画布的React组件库](https://uvcanvas.com)
- 🎥 [Jack Herrington - Tanstack Router比React-Router更好吗？](https://www.youtube.com/watch?v=qOwnQJOClrw)
- 🎥 [Theo - 深度解析Shadcn/ui工作原理](https://www.youtube.com/watch?v=AqmMx_JidGo)

<SubscribeFormEmbed placement="middle" />

---

## 💸 赞助商 {#sponsor2}

[![需要的不只是登录框？](/emails/issues/176/clerk.jpg)](https://clerk.com/?utm_source=thisweekinreact&utm_medium=newsletter&utm_campaign=middleware&utm_content=03-06-24)

**[需要的不只是登录框？](https://clerk.com/?utm_source=thisweekinreact&utm_medium=newsletter&utm_campaign=middleware&utm_content=03-06-24)**

Clerk 为 React 应用提供简化的身份验证和用户管理方案，确保现代网页应用的快速搭建。

体验 Clerk 的诸多优势：

- 💅 开箱即用的 UI 组件，涵盖登录、注册、用户资料和组织管理。支持使用任意 CSS 库定制并部署到您的域名
- 📦 提供 React、React Native、Next.js、Redwood、Remix 等框架的 SDK
- ⚡ 与 Firebase、Supabase、Convex 等 BaaS 服务商无缝集成
- 🎁 内置用户管理、社交登录、魔法链接、多因素认证等功能

通过 Clerk 的[快速入门指南和教程](https://clerk.com/docs/quickstarts/overview?utm_source=sponsorship&utm_medium=newsletter&utm_campaign=thisweekinreact&utm_term=02-28-24)立即启动您的项目 🚀

---

## 📱 React-Native {#react-native}

本节现由 [Benedikt](https://twitter.com/bndkt) 联合撰写。欢迎通过邮件或 [Twitter](https://twitter.com/bndkt) 向我们反馈意见！

[![提升 Shopify 应用性能](/emails/issues/176/shopify.jpg)](https://shopify.engineering/improving-shopify-app-s-performance)

**[提升 Shopify 应用性能](https://shopify.engineering/improving-shopify-app-s-performance)**

Shopify 长期倡导使用 React Native，但发现迁移后应用性能有所下降。他们没有归咎技术栈，而是着手进行性能优化。成果令人瞩目：应用启动速度提升 44%，页面加载时间减少 59%。以下是部分优化措施的简要总结（提示：FlashList 在其中发挥了重要作用）。详情请阅读他们的精彩总结文章：

- 初始阶段仅渲染屏幕可见内容（尤其针对首页）
- 所有页面均基于列表构建（使用 FlashList）
- 采用 inlineRequires 技术
- 批量处理状态变更
- 优化缓存机制

这些洞见极具启发性，优化成果令人印象深刻。期待 Shopify 团队持续分享细节，或许他们在此过程中构建的某些工具最终会开源？

---

- 💸 [React Universe Conf 融合了React Native EU大会精华并推出全新升级议程。3月7日前购票可享最低早鸟价](https://www.reactuniverseconf.com/?utm_campaign=React_Universe_Conf&utm_source=email&utm_content=This_Week_in_React)
- 👀 [PR - RCTRootViewFactory](https://github.com/facebook/react-native/pull/42263)：简化iOS端棕地集成方案，无需再考虑旧架构/新架构/Bridge/Bridgeless的组合问题
- 🐦 [在RN应用中实现跨应用文件拖放功能](https://x.com/alihdjr/status/1764393524940673529)
- 📖 [visionOS文档 - 现有项目集成指南](https://callstack.github.io/react-native-visionos-docs/docs/guides/integrate-into-existing-projects/)
- 📜 [Expo - 用自定义构建编排高级工作流](https://expo.dev/blog/orchestrate-advanced-workflows-with-custom-builds)：通过在Expo构建前后运行脚本（bash或JS）实现E2E测试、团队通知等场景
- 📜 [iOS实时活动与React Native - 无需打开应用即可展示最新数据](https://www.reactnative.university/blog/live-activities-unleashed)：由于需要Swift开发，本三部曲教程详细讲解为RN应用添加实时活动的完整步骤
- 📜 [React Native错误边界 - 功能边界、局部边界与服务边界](https://www.reactnative.university/blog/react-native-error-boundaries)：每个RN应用都应至少部署一个错误边界，本文阐释其必要性与实现方案
- 📜 [使用原生加密库提升速度与安全性](https://www.callstack.com/blog/increase-speed-and-security-with-native-crypto-libraries)
- 📜 [Morrow对《2023年React Native现状报告》的解读](https://www.themorrow.digital/blog/our-summary-of-the-state-of-react-native-2023-report)
- 📦 [intercom-react-native 6.5 - 新增Expo配置插件支持](https://github.com/intercom/intercom-react-native/releases/tag/6.5.0)
- 📦 [Uni Stack - 集成Expo/Prisma/tRPC的React Native启动模板](https://www.uni-stack.dev/)
- 📦 [expo-foreground-actions - 应用切换后仍可在宽限期内持续运行任务](https://github.com/Acetyld/expo-foreground-actions)
- 📦 [React Native 0.74.0 RC 2发布](https://github.com/facebook/react-native/releases/tag/v0.74.0-rc.2)
- 🎙️ [RNR第290期 - 与Bartłomiej Bukowski探讨React Native现状调查报告](https://reactnativeradio.com/episodes/the-state-of-react-native-survey-with-bartomiej-bukowski)
- 🎙️ [Rocket Ship第32期 - 从破产教师到软件工程师的Zach Taylor](https://podcast.galaxies.dev/episodes/032-from-broke-teacher-to-software-engineer-with-zach-taylor)
- 🎥 [Simon Grimm - 用React Native构建儿童绘画应用](https://www.youtube.com/watch?v=G5TjXRHoEno)
- 🎥 [notJust Dev - 开发跨Web与移动端的个人博客系统](https://www.youtube.com/watch?v=ewW6_baBXko)
- 📅 [Chain React大会演讲征集截止至2024年5月3日](https://sessionize.com/chain-react-2024/)
- 📅 [React Universe Conf 2024早鸟票今日截止](https://ti.to/RUC/react-universe-conf-2024)

---

## 🔀 其他动态 {#other}

- 💬 [TypeScript 5.5 迭代计划 - 新增 Set 方法、配置扩展合并功能](https://github.com/microsoft/TypeScript/issues/57475)
- 📜 [高效 TypeScript - 类型谓词的隐藏面](https://effectivetypescript.com/2024/02/27/type-guards/)
- 📜 [Deno - 推出 JSR - JavaScript 注册表](https://deno.com/blog/jsr_open_beta)
- 📜 [OpenJS 发起新协作项目以改进 JavaScript 包元数据的互操作性](https://socket.dev/blog/openjs-improve-interoperability-of-javascript-package-metadata)
- 📜 [开放网络倡导组织 - 苹果让步不再封杀网页应用，但斗争仍在继续](https://open-web-advocacy.org/blog/apple-backs-off-killing-web-apps/)
- 📜 [Node.js 中近期 V8 引擎的 8 大更新](https://blog.appsignal.com/2024/02/28/top-8-recent-v8-in-node-updates.html)
- 📦 [Safari 17.44 的 WebKit 新特性 - CSS @scope、align-content](https://webkit.org/blog/15063/webkit-features-in-safari-17-4/)
- 📦 [Shiki-magic-move - 丝滑动画代码块效果](https://github.com/shikijs/shiki-magic-move)
- 📦 [Parcel 2.12 - 支持通过 import 属性定义宏并在构建时运行](https://parceljs.org/blog/v2-12-0/)
- 📦 [Playwright 1.42 - 测试标签、跳过测试注解功能](https://github.com/microsoft/playwright/releases/tag/v1.42.0)

---

## 🤭 趣味一刻 {#fun}

[![alt](/emails/issues/176/meme.jpg)](https://twitter.com/sebastienlorber/status/1765373471645737153)

下期见！👋